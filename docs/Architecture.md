---
type: architecture
product: Interview Conditioning Studio
status: v0
owner: Suyash
philosophy: local-first
scope: v0 → v1
created: 2025-01-XX
---

# Architecture — Interview Conditioning Studio

> [!note]
> This document describes the **system architecture**, not implementation details.
> It encodes boundaries, invariants, and evolution paths.

---

## 1. Architectural Goals

The architecture must:

- Preserve product principles:
  - enforced constraints
  - limited nudges
  - silence window
  - no pass/fail evaluation
- Enable a **local-first v0**
- Allow clean evolution to **hosted + paid v1**
- Keep the **core logic open source**
- Prevent AI or infra complexity from corrupting the product

---

## 2. High-Level System Shape

The system is composed of **four logical layers**:

1. **Session App (UI)**
2. **Core Engine (OSS, shared)**
3. **Nudge Providers (pluggable)**
4. **Hosted Services (optional, v1+)**

Only (1) and (2) are required for v0.

---

## 3. Session App (Frontend)

### Responsibilities

- Render the interview-style session
- Enforce timing and phase transitions
- Collect all user inputs:
  - invariants
  - code
  - audio commentary
- Display nudges and session summary
- Export session bundle

### Internal Modules

- `SessionStateMachine`
- `TimerController`
- `EventLog`
- `EditorAdapter`
- `AudioRecorder`
- `NudgeOrchestrator`
- `SummaryRenderer`

> [!important]
> The Session App **never evaluates correctness**.
> It only records and presents signals.

---

## 4. Core Engine (Open Source)

This is the **heart of the product** and must remain stable, minimal, and auditable.

### Responsibilities

- Domain models:
  - session
  - phases
  - events
  - nudges
- Enforced rules:
  - invariants required before coding
  - nudge budget
  - silence window
- Signal derivation:
  - timing
  - occurrence
  - consistency
- Summary scaffolding
- Session bundle schema + versioning

### Design Constraints

- Pure logic (no UI, no network)
- Deterministic outputs from event logs
- Platform-agnostic (TypeScript library)

> [!important]
> Anything that could bias evaluation must live **outside** the Core Engine.

---

## 5. Event Log (System Backbone)

The system is **event-sourced** at the session level.

### Properties

- Append-only
- Timestamped
- Auditable
- Replayable

### Example Event Types (v0)

- `session.started`
- `prep.invariants_submitted`
- `coding.started`
- `code.changed`
- `audio.started`
- `nudge.shown`
- `phase.silent_started`
- `session.ended`
- `summary.generated`

> [!note]
> All summaries and signals must be reproducible from the event log.

---

## 6. Nudge System

### Nudge Orchestrator

Lives in the Session App but enforces Core Engine rules.

Responsibilities:

- Track remaining nudge budget
- Enforce silence window
- Decide whether a nudge may be shown

### Nudge Providers (pluggable)

- `ManualNudgeProvider` (v0)
- `HeuristicNudgeProvider` (optional v0)
- `AI Nudge Provider` (v1+, optional)

> [!important]
> Providers may _suggest_ nudges.  
> The orchestrator decides whether they are allowed.

---

## 7. Session Phases (State Machine)

Phases are strictly ordered:

1. `PREP`
2. `CODING`
3. `SILENT`
4. `SUMMARY`
5. `DONE`

### Phase Rules

- `CODING` cannot start without invariants
- Nudges allowed only during `CODING`
- Nudges forbidden during `SILENT`
- `SUMMARY` is read-only

This state machine is enforced by the Core Engine.

---

## 8. Audio Architecture (v0)

### Capture

- Browser-native audio recording
- No transcription in v0
- Stored locally

### Role in the System

- Provides raw evidence for reasoning
- Optional enrichment later (v1+)
- Never required for correctness evaluation

> [!note]
> Audio is treated as **evidence**, not an analysis target in v0.

---

## 9. Summary Generation (Bias-Safe)

Summaries are generated by **reflecting events**, not judging outcomes.

### Inputs

- Event log
- Invariants text
- Final code snapshot
- Nudge usage

### Output Structure

- Framing (prep + invariants)
- Execution (timing + activity)
- Guidance (nudges + recovery)
- Self-assessment prompt

> [!important]
> If a statement cannot be tied to a concrete event or timestamp, it is not allowed.

---

## 10. Session Bundle (System of Record)

At the end of each session, the system can export a complete bundle.

### Bundle Contents

- `session.json` — metadata + event log + reflection responses
- `code.txt` — final code snapshot
- `invariants.txt` — user's pre-coding notes
- `audio.webm` (or `.m4a`) — voice recording (optional)

### Export Format

The bundle is exported as a `.tar.gz` file using:

- Minimal TAR writer (USTAR format, ~80 lines)
- Native `CompressionStream('gzip')` API
- No external dependencies

Filename pattern: `{problem-slug}-{YYYY-MM-DD}.tar.gz`

> [!important]
> The bundle is portable, inspectable, and future-proof.

---

## 11. Hosted Architecture (v1+ Optional)

Hosting adds **convenience**, not evaluation.

### Hosted Components

- Session API
- Object Storage (bundles)
- Async enrichment workers (optional)
- Entitlement / licensing service

### Critical Rule

Hosted services **must not**:

- judge correctness
- override Core Engine rules
- introduce comparative metrics

---

## 12. Open Source Boundary

### Open Source

- Core Engine
- Session rules
- Event schema
- Summary scaffolding

### Closed / Paid (optional)

- Hosted storage
- Zero-setup UX
- Enrichment services
- Team workflows

This preserves trust and contributor alignment.

---

## 13. Architecture Invariants (Non-Negotiable)

1. Append-only event log
2. No correctness oracle
3. Nudges are budgeted and phase-gated
4. Silence window is enforced
5. Bundle is complete and portable
6. Feedback is evidential, not judgmental

---

## 14. Evolution Strategy

- v0: local-first, single-user
- v1: hosted convenience
- v2: optional enrichment (transcription, clustering)
- Never: leaderboard, pass/fail, grind mechanics

---

## Closing Note

This architecture is designed to:

- mirror real interviews
- prevent bias by design
- keep the system honest
- allow growth without corruption

If a future change violates these boundaries, it is the wrong change.
